<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Timeseries view</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="stylesheet" href="plot.css">
</head>

<body>
    <div id="buttons"></div>
    <div id="graph"><svg width="960" height="500"></svg></div>
    
    
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="timeplot.js"></script>

    <script>
        function graph(sensor_id, sensor_type) {
            fetch('http://localhost:8000/timeseries?&sensor_id=' + sensor_id + '&sensor_type=' + sensor_type)
                .then(response => response.json())
                .then(response => draw(response))
        }

        function create_buttons(sensors) {
            console.log(sensors)
            var body = document.getElementsByTagName("body")[0];
            for (var i = 0; i < sensors.length; i++) {
                const sensor_id = sensors[i]["sensor_id"];
                const sensor_type = sensors[i]["sensor_type"];
                var buttons = document.createElement("button");
                buttons.innerHTML = "Sensor " + i;
                buttons.setAttribute('class', 'sensorbutton');
                buttons.setAttribute('id', sensor_id);
                buttons.setAttribute('value', "" + i);
                buttons.style.color = "green";
                buttons.style.background = "black";
                buttons.style.boxShadow = "50%"
                buttons.onclick = function fun() {
                    graph(sensor_id, sensor_type);
                }

                document.getElementById("buttons").appendChild(buttons);
            }
        }


        fetch('http://localhost:8000/polled_sensors')
            .then(response => response.json())
            .then(sensors => {
                create_buttons(sensors)
            })
    </script>

</html>